# Система Ролей - Руководство

## Обзор

Новая система ролей основана на PHP enum и предоставляет типобезопасное управление правами пользователей.

## Роли

### Role::USER (1)
- Обычный пользователь
- Может просматривать сообщения
- Может добавлять свои сообщения
- Может редактировать только свои сообщения

### Role::ADMIN (2)
- Администратор
- Все права USER
- Может редактировать любые сообщения
- Может управлять пользователями
- Может изменять статус сообщений

## Использование

### Проверка ролей

```php
// Проверка на администратора
if ($this->checkAdmin()) {
    // Действия для администратора
}

// Проверка прав через enum (рекомендуемый способ)
$role = \Core\Role::tryFrom($user['role']);
if ($role && $role->canEditAnyMessage()) {
    // Может редактировать любые сообщения
}

if ($role && $role->canManageUsers()) {
    // Может управлять пользователями
}

// Или с использованием метода User::getRole()
$role = $user->getRole();
if ($role && $role->canEditAnyMessage()) {
    // Может редактировать любые сообщения
}
```

### В моделях

```php
// User модель
$user = User::findById(1);
if ($user->isAdmin()) {
    // Пользователь - администратор
}

$userRole = $user->getRole();
$label = $userRole ? $userRole->label() : 'Unknown';
echo $label; // "Administrator" или "User"
```

### В видах

```php
// Отображение роли в шаблоне
<?php if ($user['role'] == 2): ?>
    <span class="admin-badge">Admin</span>
<?php endif; ?>
```

## Преимущества

1. **Типобезопасность** - enum гарантирует валидные значения
2. **Читаемость** - понятные названия методов
3. **Расширяемость** - легко добавить новые роли
4. **Гибкость** - отдельные методы для разных прав

## Методы проверки прав

- `canEditAnyMessage()` - может редактировать любые сообщения
- `canManageUsers()` - может управлять пользователями
- `canToggleMessageStatus()` - может изменять статус сообщений
- `canDeleteMessages()` - может удалять сообщения

## Миграция

Существующие данные в базе данных остаются неизменными:
- `role = 1` → USER
- `role = 2` → ADMIN